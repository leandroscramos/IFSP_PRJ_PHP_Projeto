SELECT	con.numero nro_consulta, 
	con.dt_consulta data_consulta, 
	esp.nome_especialidade especialidade, 
	Upper(rapf.nome) profissional, 
	pac.prontuario, 
	pac.nome, 
	CAST(TO_CHAR(AGE(con.dt_consulta, pac.dt_nascimento), 'YYY') AS SMALLINT) AS idade_no_atendimento,
	ret.descricao situacao_atendimento
  FROM	agh.aac_consultas con 
 INNER	JOIN agh.aip_pacientes pac ON pac.codigo = con.pac_codigo
 INNER	JOIN agh.aac_grade_agendamen_consultas grd ON grd.seq = con.grd_seq
 INNER	JOIN agh.agh_especialidades esp ON esp.seq = grd.esp_seq
 INNER	JOIN agh.aac_tipo_agendamentos tag on ( tag.seq = con.fag_tag_seq )
 INNER	JOIN agh.rap_servidores raps ON raps.matricula = grd.pre_ser_matricula AND raps.vin_codigo = grd.pre_ser_vin_codigo
 INNER	JOIN agh.rap_pessoas_fisicas rapf ON rapf.codigo = raps.pes_codigo
 INNER	JOIN agh.aac_retornos ret ON con.ret_seq = ret.seq
WHERE 	con.dt_consulta::DATE >= '#data_ini' AND con.dt_consulta::DATE <= '#data_fim'
	AND grd.usl_unf_seq = 49
	AND con.ret_seq in (10,60)  -- Atendido ou Em Atendimento
 ORDER 	BY con.ret_seq, dt_consulta
