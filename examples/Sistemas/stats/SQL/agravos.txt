SELECT 	ag.prontuario, 
	ag.nome, 
	ag.sexo, 
	ag.dt_nascimento::DATE, 
	UPPER( COALESCE(ag.tipo_logr,'') || ' ' || ag.endereco || ', ' || COALESCE(COALESCE(CAST(ag.numero_endereco AS CHARACTER VARYING),''),'') ||
	CASE WHEN ag.compl_logradouro IS NOT NULL THEN ' - ' || COALESCE(ag.compl_logradouro, '') ELSE '' END || ' - ' || ag.descricao_bairro) endereco, 
	ag.cidade,
	ag.estado,
	COALESCE(ag.fone_1,ag.fone_2) fone, 
	pat.ts_appointment::DATE dt_atendimento,
	CASE WHEN fl_suspect_diseases&1 > 0 THEN 'S' ELSE 'N' END AS caxumba,
	CASE WHEN fl_suspect_diseases&2 > 0 THEN 'S' ELSE 'N' END AS conjuntivite,
	CASE WHEN fl_suspect_diseases&4 > 0 THEN 'S' ELSE 'N' END AS diarreia,
	CASE WHEN fl_suspect_diseases&8 > 0 THEN 'S' ELSE 'N' END AS varicela
  FROM	hu.man_patients pat
  LEFT	JOIN hu.vw_aghu_pacientes ag ON ag.prontuario = pat.id_medical_record
 WHERE	fl_suspect_diseases > 0
   AND	pat.ts_appointment::DATE >= '#data_ini'
   AND	pat.ts_appointment::DATE <= '#data_fim'
 ORDER  BY pat.ts_appointment
