select con.dt_consulta, esp.nome_especialidade, pac.prontuario, pac.nome, CASE WHEN dthr_fim IS NOT NULL THEN 'SIM' ELSE 'NÃƒO' END AS consulta_finalizada
from 	agh.aac_consultas con
inner 	join 	agh.aip_pacientes pac on ( pac.codigo = con.pac_codigo)
inner 	join 	agh.aac_grade_agendamen_consultas grade on ( con.grd_seq = grade.seq )
inner 	join 	agh.agh_especialidades esp on ( grade.esp_seq = esp.seq )
inner 	join 	agh.aac_tipo_agendamentos tag on ( tag.seq = con.fag_tag_seq )
where con.dt_consulta >= '#data_ini'
  and con.dt_consulta < '#data_fim'::DATE + INTERVAL '1 DAY'
  and grade.eqp_seq = 5
  and pac_codigo is not null
order by con.dt_consulta