SELECT EXTRACT(YEAR FROM inter.dthr_internacao) ano, EXTRACT(MONTH FROM inter.dthr_internacao) mes, 
count(*) total_internacoes, 
count(*) filter (where lei.unf_seq = 24) ucm, 
count(*) filter (where lei.unf_seq = 3) uca, 
count(*) filter (where lei.unf_seq = 51) usm, 
count(*) filter (where lei.unf_seq = 43) uis, 
count(*) filter (where lei.unf_seq is null) observacoes
FROM agh.ain_internacoes inter
INNER JOIN agh.aip_pacientes pac ON inter.pac_codigo = pac.codigo
LEFT  JOIN agh.ain_leitos lei ON inter.lto_lto_id = lei.lto_id
LEFT  JOIN agh.agh_unidades_funcionais unid_leito ON unid_leito.seq = lei.unf_seq
INNER JOIN agh.agh_especialidades esp ON esp.seq = inter.esp_seq
--WHERE inter.dthr_internacao >= '#data_ini' AND inter.dthr_internacao < '#data_fim'::DATE + INTERVAL '1 DAY'
WHERE inter.dthr_internacao::DATE >= '#data_ini' AND inter.dthr_internacao::DATE <= '#data_fim'
group by EXTRACT(YEAR FROM inter.dthr_internacao), EXTRACT(MONTH FROM inter.dthr_internacao)
ORDER by EXTRACT(YEAR FROM inter.dthr_internacao), EXTRACT(MONTH FROM inter.dthr_internacao)
